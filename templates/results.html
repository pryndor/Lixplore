<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ source or "Search" }} Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="results-page">

<!-- Header / Navigation -->
<div class="filters">
    <h1>{{ source or "Search" }} Results</h1>
    <a href="{{ url_for('home') }}">Back to Search</a>
</div>

<div class="result-card" id="article-{{ article_id }}">
    <h3>{{ article.get('title', 'No title available') }}</h3>

    <div class="collapse-content">
        <!-- Everything that should collapse goes inside here -->
        <div class="tags">
            {% if article.get('tags') %}
                {% for tag in article['tags'] %}
                    <span class="tag">{{ tag }}</span>
                {% endfor %}
            {% else %}
                <span class="tag-placeholder">No tags yet</span>
            {% endif %}
        </div>

        <button class="assign-tag-btn" onclick="toggleTagInput('{{ article_id }}')">
            üè∑Ô∏è Add Tag
        </button>

        <form class="add-tag-form" id="tag-form-{{ article_id }}" 
              action="{{ url_for('add_tags', article_id=article_id) }}" method="POST" style="display:none;">
            <input type="text" name="tags" placeholder="Enter tag (comma-separated)" class="tag-input">
            <button type="submit" class="btn btn-sm">Add</button>
        </form>

        <p>{{ article.get('abstract', 'No abstract available') }}</p>

        {% if article.get('authors') %}
            <p><strong>Authors:</strong> 
               {{ article['authors'] if article['authors'] is string else article['authors'] | join(', ') }}
            </p>
        {% endif %}
        {% if article.get('pmid') %}
            <p><strong>PMID:</strong> {{ article['pmid'] }}</p>
        {% endif %}
        {% if article.get('doi') %}
            <p><strong>DOI:</strong> <a href="https://doi.org/{{ article['doi'] }}" target="_blank">{{ article['doi'] }}</a></p>
        {% endif %}
        {% if article.get('affiliations') %}
            <p><strong>Affiliations:</strong> 
               {{ article['affiliations'] if article['affiliations'] is string else article['affiliations'] | join(', ') }}
            </p>
        {% endif %}
    </div>

    <div class="action-buttons">
        {% if article.get('url') %}
            <a href="{{ article['url'] }}" target="_blank" class="action-link">View full text</a>
        {% endif %}
        {% if article.get('citation') %}
            &nbsp;|&nbsp;
            <a href="#" class="action-link citation-link"
               data-citation="{{ article['citation']|escapejs }}"
               data-title="{{ article.get('title','')|escapejs }}"
               data-authors="{{ article['authors'] if article['authors'] is string else article['authors'] | join('; ') | escapejs }}"
               data-year="{{ article.get('year','') }}"
               data-doi="{{ article.get('doi','') }}">
               Cite this article
            </a>
        {% endif %}
    </div>

    <button class="toggle-btn">Show more</button>
</div>


{#
<div class="results-container">
    {% if results %}
       {% for article in results %}
          {% set article_id = article.get('id', article.get('pmid')) %}
          <div class="result-card" id="article-{{ article_id }}">
              <h3>{{ article.get('title', 'No title available') }}</h3> 

              <!-- Tags display -->
              <div class="tags">
                  {% if article.get('tags') %}
                      {% for tag in article['tags'] %}
                          <span class="tag">{{ tag }}</span>
                      {% endfor %}
                  {% else %}
                      <span class="tag-placeholder">No tags yet</span>
                  {% endif %}
              </div>

              <!-- Assign Tag Button / Icon -->
              <button class="assign-tag-btn" onclick="toggleTagInput('{{ article_id }}')">
                  üè∑Ô∏è Add Tag
              </button>

              <!-- Hidden Add Tag Input -->
              <form class="add-tag-form" id="tag-form-{{ article_id }}" 
                    action="{{ url_for('add_tags', article_id=article_id) }}" method="POST" style="display:none;">
                  <input type="text" name="tags" placeholder="Enter tag (comma-separated)" class="tag-input">
                  <button type="submit" class="btn btn-sm">Add</button>
              </form>

              <!-- Article details / abstract -->
              <div class="collapse-content">
                  <p>{{ article.get('abstract', 'No abstract available') }}</p>

                  {% if article.get('authors') %}
                      <p><strong>Authors:</strong> 
                         {{ article['authors'] if article['authors'] is string else article['authors'] | join(', ') }}
                      </p>
                  {% endif %}
                  {% if article.get('pmid') %}
                      <p><strong>PMID:</strong> {{ article['pmid'] }}</p>
                  {% endif %}
                  {% if article.get('doi') %}
                      <p><strong>DOI:</strong> <a href="https://doi.org/{{ article['doi'] }}" target="_blank">{{ article['doi'] }}</a></p>
                  {% endif %}
                  {% if article.get('affiliations') %}
                      <p><strong>Affiliations:</strong> 
                         {{ article['affiliations'] if article['affiliations'] is string else article['affiliations'] | join(', ') }}
                      </p>
                  {% endif %}

                  <div class="action-buttons">
                      {% if article.get('url') %}
                          <a href="{{ article['url'] }}" target="_blank" class="action-link">View full text</a>
                      {% endif %}
                      {% if article.get('citation') %}
                          &nbsp;|&nbsp;
                          <a href="#" class="action-link citation-link"
                             data-citation="{{ article['citation']|escapejs }}"
                             data-title="{{ article.get('title','')|escapejs }}"
                             data-authors="{{ article['authors'] if article['authors'] is string else article['authors'] | join('; ') | escapejs }}"
                             data-year="{{ article.get('year','') }}"
                             data-doi="{{ article.get('doi','') }}">
                             Cite this article
                          </a>
                      {% endif %}
                  </div>
              </div>

              <button class="toggle-btn">Show more</button>
          </div>
       {% endfor %}
    {% else %}
       <p>No results found.</p>
    {% endif %}
</div>
#}

<script>
function toggleTagInput(articleId) {
    const form = document.getElementById(`tag-form-${articleId}`);
    form.style.display = (form.style.display === "none") ? "block" : "none";
}
</script>

</body>
</html>

